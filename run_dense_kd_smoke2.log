Starting multi-GPU training with 2 GPUs
Config file: /home/zjq/document/plant_seg/configs/plant_fewshot_optimized.yaml
Port: 29500
WARNING:__main__:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
2025-09-14 14:16:27.470 | INFO     | __main__:main:394 - [LESION] Config loaded: path=/home/zjq/document/plant_seg/configs/plant_fewshot_optimized.yaml distill.enabled=True
2025-09-14 14:16:29.261 | INFO     | __main__:main:434 - [LESION] model.proj_head=mlp proj_mid_dim=512 proj_norm=bn proj_dropout=0.1
2025-09-14 14:16:29.261 | INFO     | __main__:main:442 - [LESION] ProjectionHead2D arch: ProjectionHead2D(
  (net): Sequential(
    (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(1, 1))
    (1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): GELU(approximate='none')
    (3): Dropout2d(p=0.1, inplace=False)
    (4): Conv2d(512, 512, kernel_size=(1, 1), stride=(1, 1))
  )
) | params=395264
2025-09-14 14:16:29.262 | INFO     | __main__:main:434 - [LESION] model.proj_head=mlp proj_mid_dim=512 proj_norm=bn proj_dropout=0.1
2025-09-14 14:16:29.262 | INFO     | __main__:main:442 - [LESION] ProjectionHead2D arch: ProjectionHead2D(
  (net): Sequential(
    (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(1, 1))
    (1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): GELU(approximate='none')
    (3): Dropout2d(p=0.1, inplace=False)
    (4): Conv2d(512, 512, kernel_size=(1, 1), stride=(1, 1))
  )
) | params=395264
2025-09-14 14:16:29.262 | INFO     | __main__:main:461 - [LESION] Distillation enabled: teacher_type=dino
2025-09-14 14:16:40.572 | INFO     | __main__:main:476 - [LESION] Debug summary -> device=cuda:1 world_size=2 train_size=1120 val_size=972 batch=4x2 num_classes=2
2025-09-14 14:16:40.572 | INFO     | __main__:main:481 - [LESION] Using DinoTeacher: backbone=vit_base_patch14_dinov2.lvd142m bank_size=256 tau=0.5
2025-09-14 14:16:40.589 | INFO     | __main__:main:577 - [LESION] Adjusted projection head out_dim from 512 -> teacher_dim 768 to avoid dim mismatch
2025-09-14 14:16:40.637 | INFO     | __main__:main:476 - [LESION] Debug summary -> device=cuda:0 world_size=2 train_size=1120 val_size=972 batch=4x2 num_classes=2
2025-09-14 14:16:40.637 | INFO     | __main__:main:481 - [LESION] Using DinoTeacher: backbone=vit_base_patch14_dinov2.lvd142m bank_size=256 tau=0.5
2025-09-14 14:16:40.659 | INFO     | __main__:main:577 - [LESION] Adjusted projection head out_dim from 512 -> teacher_dim 768 to avoid dim mismatch
/home/zjq/.conda/envs/clip/lib/python3.9/site-packages/torch/autograd/graph.py:825: UserWarning: Grad strides do not match bucket view strides. This may indicate grad was not created according to the gradient layout contract, or that the param's strides changed since DDP was constructed.  This is not an error, but may impair performance.
grad.sizes() = [2048, 1, 3, 3], strides() = [9, 1, 3, 1]
bucket_view.sizes() = [2048, 1, 3, 3], strides() = [9, 9, 3, 1] (Triggered internally at ../torch/csrc/distributed/c10d/reducer.cpp:327.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
/home/zjq/.conda/envs/clip/lib/python3.9/site-packages/torch/autograd/graph.py:825: UserWarning: Grad strides do not match bucket view strides. This may indicate grad was not created according to the gradient layout contract, or that the param's strides changed since DDP was constructed.  This is not an error, but may impair performance.
grad.sizes() = [2048, 1, 3, 3], strides() = [9, 1, 3, 1]
bucket_view.sizes() = [2048, 1, 3, 3], strides() = [9, 9, 3, 1] (Triggered internally at ../torch/csrc/distributed/c10d/reducer.cpp:327.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
2025-09-14 14:16:44.256 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 0 Iter 0/140 lr=4.00000e-04 loss=1.9685 ce=0.8102 dice=0.5747 g=1.4288 l=0.9773 wg=0.000 wl=0.645 posfrac=0.2081
2025-09-14 14:17:44.914 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 0 Iter 139/140 lr=3.74891e-04 loss=1.3203 ce=0.5158 dice=0.3823 g=5.1192 l=0.5655 wg=0.000 wl=0.796 posfrac=0.2381
2025-09-14 14:17:46.069 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 1 Iter 0/140 lr=3.74709e-04 loss=1.1252 ce=0.3827 dice=0.2809 g=5.5152 l=0.6026 wg=0.000 wl=0.800 posfrac=0.2651
2025-09-14 14:18:48.461 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 1 Iter 139/140 lr=3.49410e-04 loss=1.1555 ce=0.4446 dice=0.3368 g=5.5644 l=0.4945 wg=0.000 wl=0.800 posfrac=0.2328
2025-09-14 14:19:01.238 | INFO     | __main__:main:612 - [LESION] Val Dice(lesion)=0.5444 | mIoU(2cls)=0.6011 | IoU_per_class=[0.8281, 0.3740] @ epoch 1
2025-09-14 14:19:01.239 | INFO     | __main__:main:615 - [LESION][Diag] IoU1=0.3740 | Prec1=0.6766 | Rec1=0.4555 | IoU1|pos=0.3740 | p(pos|lesion)=0.488 | p(pos|bg)=0.145 | lesion_imgs=486/972
2025-09-14 14:19:04.153 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 2 Iter 0/140 lr=3.49228e-04 loss=0.9480 ce=0.2426 dice=0.2598 g=5.6312 l=0.5527 wg=0.000 wl=0.800 posfrac=0.2005
2025-09-14 14:20:06.017 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 2 Iter 139/140 lr=3.23722e-04 loss=1.0765 ce=0.4220 dice=0.3049 g=5.5511 l=0.4663 wg=0.000 wl=0.800 posfrac=0.2434
2025-09-14 14:20:07.077 | INFO     | __main__:train_one_epoch_lesion:236 - [LESION] Epoch 3 Iter 0/140 lr=3.23537e-04 loss=0.9733 ce=0.4182 dice=0.2645 g=5.4804 l=0.4018 wg=0.000 wl=0.800 posfrac=0.5037
